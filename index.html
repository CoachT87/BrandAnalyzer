<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand Intelligence Assistant</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons (Standalone version) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .brand-card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 1px solid #e5e7eb;
        }
        .dark .brand-card {
            background-color: #1f2937; /* slate-800 */
            border-color: #374151; /* slate-700 */
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center max-w-3xl mx-auto mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-800 dark:text-slate-100 tracking-tight">Brand Intelligence Assistant</h1>
            <p class="mt-4 text-lg text-slate-600 dark:text-slate-400">
                Get an AI-generated brand analysis for any company. Enter a URL to generate a report based on the AI's extensive knowledge base.
            </p>
        </header>

        <div class="max-w-3xl mx-auto">
            <form id="analysis-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                <div class="relative">
                     <label for="company-url" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Your Company URL</label>
                     <i data-lucide="link" class="absolute bottom-3 left-3 w-5 h-5 text-slate-400"></i>
                     <input id="company-url" type="text" placeholder="e.g., 'yourbrand.com'" class="w-full pl-10 pr-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 focus:ring-2 focus:ring-sky-500 focus:outline-none transition" />
                </div>
                <div class="relative">
                     <label for="competitor-url" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Competitor URL</label>
                     <i data-lucide="link" class="absolute bottom-3 left-3 w-5 h-5 text-slate-400"></i>
                     <input id="competitor-url" type="text" placeholder="e.g., 'competitor.com'" class="w-full pl-10 pr-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 focus:ring-2 focus:ring-sky-500 focus:outline-none transition" />
                </div>
                <button id="analyze-button" type="submit" class="md:col-span-2 flex items-center justify-center gap-2 bg-sky-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:bg-slate-400 disabled:cursor-not-allowed transition-all duration-200">
                    <span id="button-text"><i data-lucide="search" class="inline-block w-5 h-5 mr-2"></i>Analyze Brands</span>
                    <span id="button-loader" class="hidden"><i data-lucide="wind" class="inline-block w-5 h-5 mr-2 animate-spin"></i>Analyzing...</span>
                </button>
            </form>
            <p id="error-message" class="text-red-500 mt-4 text-center"></p>
        </div>

        <main id="reports-container" class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
            <!-- Reports will be injected here -->
        </main>
         <div id="loader-container" class="text-center p-8 hidden"></div>
    </div>

    <script>
        // Use window.onload to ensure all external scripts are fully loaded before executing app code.
        window.onload = () => {
            // --- DOM Element References ---
            const form = document.getElementById('analysis-form');
            const companyUrlInput = document.getElementById('company-url');
            const competitorUrlInput = document.getElementById('competitor-url');
            const errorMessage = document.getElementById('error-message');
            const reportsContainer = document.getElementById('reports-container');
            const loaderContainer = document.getElementById('loader-container');
            const analyzeButton = document.getElementById('analyze-button');
            const buttonText = document.getElementById('button-text');
            const buttonLoader = document.getElementById('button-loader');

            // --- UI Render Functions ---
            const renderIcon = (name) => `<i data-lucide="${name}" class="w-5 h-5 text-slate-500 dark:text-slate-400"></i>`;
            const renderStrategicIcon = (name) => `<i data-lucide="${name}" class="w-6 h-6 flex-shrink-0"></i>`;

            const renderInfoCard = (icon, title, content, customClass = '') => `
                <div class="brand-card ${customClass}">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="bg-slate-100 dark:bg-slate-700 p-2 rounded-lg">${renderIcon(icon)}</div>
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-100">${title}</h3>
                    </div>
                    <div class="space-y-3 text-sm text-slate-600 dark:text-slate-300">${content}</div>
                </div>`;

            const renderKeyValueRow = (label, value) => `
                <div class="flex justify-between items-start gap-4">
                    <p class="font-medium text-slate-500 dark:text-slate-400 flex-shrink-0">${label}:</p>
                    <div class="text-right">${value}</div>
                </div>`;

            const renderScoreBar = (score, label, colorClass) => `
                <div>
                    <div class="flex justify-between mb-1"><span class="text-sm font-medium text-slate-600 dark:text-slate-300">${label}</span><span class="text-sm font-bold ${colorClass}">${score}/10</span></div>
                    <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5"><div class="${colorClass} h-2.5 rounded-full" style="width: ${score * 10}%"></div></div>
                </div>`;
            
            const renderTag = (text, customClass = 'bg-sky-100 text-sky-800 dark:bg-sky-900 dark:text-sky-300') => `<span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-medium ${customClass}">${text}</span>`;

            const renderContentStrategyChart = (mix) => {
                const colors = { Educational: 'bg-sky-500', Promotional: 'bg-teal-500', Community: 'bg-amber-500', Culture: 'bg-indigo-500' };
                let chartHtml = '<div class="space-y-2">';
                for (const [key, value] of Object.entries(mix || {})) {
                    chartHtml += `<div><div class="flex justify-between text-xs mb-1"><span>${key}</span><span>${value}%</span></div><div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2"><div class="${colors[key] || 'bg-slate-400'} h-2 rounded-full" style="width: ${value}%"></div></div></div>`;
                }
                return chartHtml + '</div>';
            };
            
            const renderStrategicTakeawayCard = (icon, title, content, className) => `
                <div class="p-4 rounded-lg ${className}">
                    <div class="flex items-center gap-3 mb-2">${renderStrategicIcon(icon)}<h4 class="font-semibold text-md">${title}</h4></div>
                    <p class="text-sm">${content}</p>
                </div>`;

            const renderFullReport = (data, title) => {
                const { brandIdentity, messaging, trust, seoAndKeywords, contentStrategy, crunchbase, socialMedia, strategicTakeaways } = data;
                const identityContent = `${renderKeyValueRow('Primary Colors', `<div class="flex gap-2 justify-end">${brandIdentity.primaryColors.map(c => `<div class="w-5 h-5 rounded-full border border-slate-300" style="background-color: ${c}"></div>`).join('')}</div>`)}${renderKeyValueRow('Font Styles', brandIdentity.fontStyles.join(', '))}${renderKeyValueRow('Logo', brandIdentity.logoDescription)}${renderKeyValueRow('Imagery', brandIdentity.imageryStyle)}${renderScoreBar(brandIdentity.visualConsistencyScore, 'Visual Consistency', 'text-sky-600 bg-sky-500')}`;
                const messagingContent = `${renderKeyValueRow('Headline', `"${messaging.homepageHeadline}"`)}${renderKeyValueRow('Value Prop.', messaging.valueProposition)}${renderKeyValueRow('Tone', renderTag(messaging.toneOfVoice))}${renderKeyValueRow('Target', renderTag(messaging.targetCustomer, 'bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-300'))}${renderKeyValueRow('Main CTA', renderTag(messaging.mainCTA, 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-300'))}`;
                const seoContent = `${renderKeyValueRow('Strength', seoAndKeywords.seoStrength)}${renderKeyValueRow('Keywords', `<div class="flex flex-wrap gap-1 justify-end">${seoAndKeywords.topKeywords.map(k => renderTag(k)).join('')}</div>`)}`;
                const crunchbaseContent = `${renderKeyValueRow('Founded', crunchbase.foundedYear)}${renderKeyValueRow('Founders', crunchbase.founders.join(', '))}${renderKeyValueRow('Location', crunchbase.location)}${renderKeyValueRow('Funding', `${crunchbase.lastFundingRound} (${crunchbase.totalFunding} total)`)}`;
                const socialContent = `${renderKeyValueRow('Trust Signals', trust.trustSignals.join(', '))}${renderKeyValueRow('Testimonials', trust.testimonials)}${renderScoreBar(socialMedia.socialVoiceConsistencyScore, 'Social Voice Consistency', 'text-green-600 bg-green-500')}`;
                const strategicContent = `${renderStrategicTakeawayCard('copy', 'Observed Strengths', strategicTakeaways.observedStrengths, 'bg-green-50 dark:bg-green-900/50 text-green-800 dark:text-green-200')}${renderStrategicTakeawayCard('zap', 'Potential Opportunities', strategicTakeaways.potentialOpportunities, 'bg-blue-50 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200')}`;
                
                return `<div class="space-y-6"><h2 class="text-2xl font-bold text-center text-slate-800 dark:text-slate-100">${title}</h2>${renderInfoCard('brain-circuit', 'Strategic Analysis', strategicContent, 'border-indigo-500 border-2')}<div class="grid lg:grid-cols-2 gap-6">${renderInfoCard('briefcase', 'Brand Identity', identityContent)}${renderInfoCard('message-square', 'Messaging & Positioning', messagingContent)}${renderInfoCard('target', 'SEO & Keywords', seoContent)}${renderInfoCard('pie-chart', 'Content Strategy', renderContentStrategyChart(contentStrategy.contentMix))}${renderInfoCard('building', 'Crunchbase Snapshot', crunchbaseContent)}${renderInfoCard('thumbs-up', 'Social & Trust', socialContent)}</div></div>`;
            };
            
            const renderSpinner = (status) => {
                loaderContainer.innerHTML = `<div class="flex flex-col items-center justify-center p-8 text-center"><i data-lucide="wind" class="w-12 h-12 text-sky-500 animate-spin mb-4"></i><h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200">${status}</h2><p class="text-slate-500 dark:text-slate-400 mt-2">Synthesizing data from our knowledge base.</p></div>`;
                lucide.createIcons();
            };

            // --- API LOGIC ---
            const makeApiCall = async (prompt) => {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorBody = await response.json().catch(() => ({ message: response.statusText }));
                    throw new Error(errorBody?.error?.message || response.statusText);
                }
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const cleanedText = result.candidates[0].content.parts[0].text.replace(/^```json\n/, '').replace(/\n```$/, '');
                    return JSON.parse(cleanedText);
                }
                throw new Error("The model returned an empty or invalid response.");
            };

            const getFactualData = (nameOrUrl) => {
                const prompt = `Based on your knowledge base, provide a factual data report for the company associated with the URL: "${nameOrUrl}". Do NOT analyze or give opinions. Only return known or plausible data. Return a single JSON object. Schema: { "brandIdentity": { "primaryColors": ["#hex1"], "fontStyles": ["Font"], "logoDescription": "...", "imageryStyle": "...", "visualConsistencyScore": 10 }, "messaging": { "homepageHeadline": "...", "valueProposition": "...", "toneOfVoice": "...", "targetCustomer": "...", "mainCTA": "..." }, "trust": { "trustSignals": ["..."], "testimonials": "...", "certifications": ["..."] }, "seoAndKeywords": { "topKeywords": ["keyword1"], "seoStrength": "Weak" }, "contentStrategy": { "contentMix": { "Educational": 40, "Promotional": 30, "Community": 20, "Culture": 10 } }, "crunchbase": { "foundedYear": "...", "founders": ["..."], "location": "...", "lastFundingRound": "...", "totalFunding": "...", "topInvestors": ["..."] }, "socialMedia": { "linkedinSummary": "...", "twitterSummary": "...", "socialVoiceConsistencyScore": 10 } }`;
                return makeApiCall(prompt);
            };

            const getStrategicTakeaways = (factualData) => {
                const prompt = `Given the factual brand data: ${JSON.stringify(factualData)}. Act as a strategic brand consultant. Provide analysis based ONLY on the data. Return a single JSON object. Schema: { "evaluation": { "positioningClarity": "Clear", "visualBrandingQuality": "Strong", "buyerResonance": "High", "differentiator": "..." }, "strategicTakeaways": { "observedStrengths": "What are the most effective strategies in this data?", "potentialOpportunities": "Based on this data, what market gaps could a competitor exploit?" } }`;
                return makeApiCall(prompt);
            };

            const processCompany = async (url, statusCallback) => {
                statusCallback(`Retrieving facts for ${url}...`);
                const factualData = await getFactualData(url);
                statusCallback(`Analyzing strategy for ${url}...`);
                const strategicData = await getStrategicTakeaways(factualData);
                return { ...factualData, ...strategicData };
            };

            // --- EVENT HANDLER ---
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const companyUrl = companyUrlInput.value.trim();
                const competitorUrl = competitorUrlInput.value.trim();

                if (!companyUrl) {
                    errorMessage.textContent = "Please enter your company's URL.";
                    return;
                }

                errorMessage.textContent = '';
                reportsContainer.innerHTML = '';
                loaderContainer.classList.remove('hidden');
                analyzeButton.disabled = true;
                buttonText.classList.add('hidden');
                buttonLoader.classList.remove('hidden');
                lucide.createIcons();

                try {
                    const statusCallback = (status) => renderSpinner(status);
                    const companyData = await processCompany(companyUrl, statusCallback);
                    
                    let competitorData = null;
                    if (competitorUrl) {
                        competitorData = await processCompany(competitorUrl, statusCallback);
                    }
                    
                    let finalHtml = '';
                    if (companyData) finalHtml += renderFullReport(companyData, 'Your Brand');
                    if (competitorData) finalHtml += renderFullReport(competitorData, 'Competitor');
                    reportsContainer.innerHTML = finalHtml;

                } catch (err) {
                    errorMessage.textContent = `Analysis failed. The API returned an error: "${err.message}". This can happen due to content policies or if the company is not in the knowledge base. Please try a different URL.`;
                } finally {
                    loaderContainer.classList.add('hidden');
                    analyzeButton.disabled = false;
                    buttonText.classList.remove('hidden');
                    buttonLoader.classList.add('hidden');
                    lucide.createIcons();
                }
            });

            // Initial icon render
            lucide.createIcons();
        };
    </script>
</body>
</html>
